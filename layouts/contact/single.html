{{ define "main" }}
<article class="contact-page">
    <header class="page-header">
        <h1>{{ .Title }}</h1>
        {{ if .Description }}
        <p class="page-description">{{ .Description }}</p>
        {{ end }}
    </header>
    
    <div class="contact-content">
        {{ .Content }}
        
        <!-- Contact Form -->
        <div class="contact-form-section">
            <form 
                name="contact" 
                method="POST" 
                data-netlify="true" 
                data-netlify-honeypot="bot-field"
                action="/contact/success/"
                class="contact-form"
                novalidate
            >
                <!-- Honeypot field for spam protection -->
                <div class="hidden">
                    <label>Don't fill this out if you're human: 
                        <input name="bot-field" />
                    </label>
                </div>
                
                <!-- Hidden field for Netlify form detection -->
                <input type="hidden" name="form-name" value="contact" />
                
                <div class="form-group">
                    <label for="name" class="form-label">
                        Name <span class="required" aria-label="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        class="form-input" 
                        required 
                        aria-describedby="name-error"
                        autocomplete="name"
                    />
                    <div id="name-error" class="error-message" role="alert" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="email" class="form-label">
                        Email <span class="required" aria-label="required">*</span>
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        required 
                        aria-describedby="email-error"
                        autocomplete="email"
                    />
                    <div id="email-error" class="error-message" role="alert" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="phone" class="form-label">
                        Phone
                    </label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        class="form-input" 
                        aria-describedby="phone-error"
                        autocomplete="tel"
                    />
                    <div id="phone-error" class="error-message" role="alert" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="message" class="form-label">
                        Message <span class="required" aria-label="required">*</span>
                    </label>
                    <textarea 
                        id="message" 
                        name="message" 
                        class="form-textarea" 
                        rows="6" 
                        required 
                        aria-describedby="message-error"
                        placeholder="Tell us about your inquiry, questions about joining, or how we can help..."
                    ></textarea>
                    <div id="message-error" class="error-message" role="alert" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="form-submit" id="submit-btn">
                        <span class="submit-text">Send Message</span>
                        <span class="submit-loading" style="display: none;">Sending...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</article>

<!-- Form Validation JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.contact-form');
    const nameField = document.getElementById('name');
    const emailField = document.getElementById('email');
    const phoneField = document.getElementById('phone');
    const messageField = document.getElementById('message');
    
    // Restore form data if returning from error page
    const savedData = localStorage.getItem('contactFormData');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            // Only restore if data is less than 1 hour old
            const dataAge = new Date() - new Date(data.timestamp);
            if (dataAge < 3600000) { // 1 hour in milliseconds
                nameField.value = data.name || '';
                emailField.value = data.email || '';
                phoneField.value = data.phone || '';
                messageField.value = data.message || '';
                
                // Show a message that data was restored
                const restoredMessage = document.createElement('div');
                restoredMessage.className = 'form-restored-message';
                restoredMessage.innerHTML = '<p><strong>Form data restored.</strong> Your previous message was saved and restored.</p>';
                form.insertBefore(restoredMessage, form.firstChild);
                
                // Remove the message after 5 seconds
                setTimeout(function() {
                    if (restoredMessage.parentNode) {
                        restoredMessage.parentNode.removeChild(restoredMessage);
                    }
                }, 5000);
            }
            // Clear old data
            localStorage.removeItem('contactFormData');
        } catch (e) {
            // Invalid data, clear it
            localStorage.removeItem('contactFormData');
        }
    }
    
    // Validation functions
    function validateName(name) {
        return name.trim().length >= 2;
    }
    
    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email.trim());
    }
    
    function validatePhone(phone) {
        // Phone is optional, but if provided should be valid
        if (!phone.trim()) return true;
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        return phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''));
    }
    
    function validateMessage(message) {
        return message.trim().length >= 10;
    }
    
    // Show error message
    function showError(field, message) {
        const errorDiv = document.getElementById(field.id + '-error');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        field.classList.add('error');
        field.setAttribute('aria-invalid', 'true');
    }
    
    // Clear error message
    function clearError(field) {
        const errorDiv = document.getElementById(field.id + '-error');
        errorDiv.textContent = '';
        errorDiv.style.display = 'none';
        field.classList.remove('error');
        field.setAttribute('aria-invalid', 'false');
    }
    
    // Real-time validation
    nameField.addEventListener('blur', function() {
        if (!validateName(this.value)) {
            showError(this, 'Please enter your full name (at least 2 characters)');
        } else {
            clearError(this);
        }
    });
    
    emailField.addEventListener('blur', function() {
        if (!validateEmail(this.value)) {
            showError(this, 'Please enter a valid email address');
        } else {
            clearError(this);
        }
    });
    
    phoneField.addEventListener('blur', function() {
        if (!validatePhone(this.value)) {
            showError(this, 'Please enter a valid phone number');
        } else {
            clearError(this);
        }
    });
    
    messageField.addEventListener('blur', function() {
        if (!validateMessage(this.value)) {
            showError(this, 'Please enter a message (at least 10 characters)');
        } else {
            clearError(this);
        }
    });
    
    // Form submission validation and feedback
    form.addEventListener('submit', function(e) {
        let isValid = true;
        const submitBtn = document.getElementById('submit-btn');
        const submitText = submitBtn.querySelector('.submit-text');
        const submitLoading = submitBtn.querySelector('.submit-loading');
        
        // Clear all previous errors
        [nameField, emailField, phoneField, messageField].forEach(clearError);
        
        // Validate all fields
        if (!validateName(nameField.value)) {
            showError(nameField, 'Please enter your full name (at least 2 characters)');
            isValid = false;
        }
        
        if (!validateEmail(emailField.value)) {
            showError(emailField, 'Please enter a valid email address');
            isValid = false;
        }
        
        if (!validatePhone(phoneField.value)) {
            showError(phoneField, 'Please enter a valid phone number');
            isValid = false;
        }
        
        if (!validateMessage(messageField.value)) {
            showError(messageField, 'Please enter a message (at least 10 characters)');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            // Focus on first error field
            const firstError = form.querySelector('.error');
            if (firstError) {
                firstError.focus();
            }
        } else {
            // Show loading state
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline';
            
            // Store form data in case of error
            localStorage.setItem('contactFormData', JSON.stringify({
                name: nameField.value,
                email: emailField.value,
                phone: phoneField.value,
                message: messageField.value,
                timestamp: new Date().toISOString()
            }));
        }
    });
    
    // Handle form submission timeout (fallback)
    let submissionTimeout;
    form.addEventListener('submit', function() {
        submissionTimeout = setTimeout(function() {
            // If form hasn't redirected after 10 seconds, show error
            window.location.href = '/contact/error/';
        }, 10000);
    });
    
    // Clear timeout if page unloads (successful submission)
    window.addEventListener('beforeunload', function() {
        if (submissionTimeout) {
            clearTimeout(submissionTimeout);
        }
    });
});
</script>
{{ end }}